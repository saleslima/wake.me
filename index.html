<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Sistema de Transporte e Alerta</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
            -webkit-text-size-adjust: 100%;
        }
        
        html {
            font-size: 16px;
        }
        
        body {
            background: linear-gradient(135deg, #1a237e, #4a148c);
            color: #fff;
            min-height: 100vh;
            padding: 10px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 10px;
            width: 100%;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
            color: #bb86fc;
            line-height: 1.3;
            word-wrap: break-word;
        }
        
        .subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
            line-height: 1.4;
            padding: 0 5px;
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        /* Layout responsivo para tablets e desktops */
        @media (min-width: 768px) {
            html {
                font-size: 17px;
            }
            
            .container {
                padding: 15px;
            }
            
            header {
                padding: 20px;
                margin-bottom: 25px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .main-content {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 25px;
            }
        }
        
        @media (min-width: 1024px) {
            html {
                font-size: 18px;
            }
            
            h1 {
                font-size: 2.8rem;
            }
            
            .main-content {
                gap: 30px;
            }
        }
        
        .section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.1);
            width: 100%;
            overflow: hidden;
        }
        
        @media (min-width: 768px) {
            .section {
                padding: 25px;
            }
        }
        
        .section-title {
            font-size: 1.4rem;
            margin-bottom: 15px;
            color: #bb86fc;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .section-title i {
            font-size: 1.2rem;
        }
        
        @media (min-width: 768px) {
            .section-title {
                font-size: 1.6rem;
                margin-bottom: 20px;
            }
            
            .section-title i {
                font-size: 1.4rem;
            }
        }
        
        .buttons-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .transport-btn {
            background: linear-gradient(to right, #6200ea, #3700b3);
            color: white;
            border: none;
            padding: 16px 20px;
            font-size: 1.1rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
            width: 100%;
            touch-action: manipulation;
            min-height: 60px;
        }
        
        .transport-btn:active {
            transform: scale(0.98);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        @media (min-width: 768px) {
            .transport-btn:hover {
                transform: translateY(-3px);
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
                background: linear-gradient(to right, #3700b3, #6200ea);
            }
            
            .transport-btn:active {
                transform: scale(0.98);
            }
        }
        
        .transport-btn i {
            font-size: 1.2rem;
        }
        
        .btn-content {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }
        
        .btn-arrow {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .back-btn {
            background: linear-gradient(to right, #616161, #9e9e9e);
            padding: 10px 15px;
            border-radius: 8px;
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
            font-size: 0.9rem;
            width: 100%;
            justify-content: center;
            touch-action: manipulation;
        }
        
        .back-btn:active {
            transform: scale(0.98);
        }
        
        .options-container {
            max-height: 50vh;
            overflow-y: auto;
            padding: 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            margin-bottom: 15px;
            display: none;
            -webkit-overflow-scrolling: touch;
        }
        
        /* Estilização da scrollbar para mobile */
        .options-container::-webkit-scrollbar {
            width: 6px;
        }
        
        .options-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        .options-container::-webkit-scrollbar-thumb {
            background: #bb86fc;
            border-radius: 10px;
        }
        
        .option-item {
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            margin-bottom: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            touch-action: manipulation;
            user-select: none;
        }
        
        .option-item:active {
            transform: scale(0.98);
            background: rgba(255, 255, 255, 0.2);
        }
        
        @media (min-width: 768px) {
            .option-item:hover {
                background: rgba(255, 255, 255, 0.2);
                transform: translateX(5px);
            }
        }
        
        .line-item {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .line-color {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        
        .station-item {
            padding-left: 25px;
            position: relative;
        }
        
        .station-item:before {
            content: "●";
            position: absolute;
            left: 10px;
            color: #bb86fc;
            font-size: 0.8rem;
        }
        
        .selected {
            background: rgba(187, 134, 252, 0.3);
            border-left: 4px solid #bb86fc;
        }
        
        .address-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .form-row {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        @media (min-width: 480px) {
            .form-row {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 12px;
            }
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        label {
            font-weight: 600;
            color: #bb86fc;
            font-size: 0.9rem;
        }
        
        input, select {
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 1rem;
            width: 100%;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        
        select {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 20px;
            padding-right: 45px;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #bb86fc;
            box-shadow: 0 0 0 2px rgba(187, 134, 252, 0.2);
        }
        
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 14px 25px;
            font-size: 1.1rem;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex: 1;
            min-width: 200px;
            max-width: 100%;
            touch-action: manipulation;
        }
        
        .action-btn:active {
            transform: scale(0.98);
        }
        
        .confirm-btn {
            background: linear-gradient(to right, #00c853, #64dd17);
            color: white;
        }
        
        @media (min-width: 768px) {
            .confirm-btn:hover {
                background: linear-gradient(to right, #00e676, #00c853);
                transform: translateY(-3px);
                box-shadow: 0 5px 15px rgba(0, 200, 83, 0.4);
            }
        }
        
        .alarm-section {
            grid-column: 1 / -1;
            text-align: center;
        }
        
        .alarm-controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 15px;
        }
        
        @media (min-width: 480px) {
            .alarm-controls {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
                align-items: center;
                gap: 15px;
            }
        }
        
        .alarm-btn {
            padding: 12px 20px;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 160px;
            max-width: 100%;
            touch-action: manipulation;
        }
        
        .alarm-btn:active {
            transform: scale(0.98);
        }
        
        @media (min-width: 768px) {
            .alarm-btn:hover {
                transform: translateY(-3px);
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            }
        }
        
        .alarm-on {
            background: linear-gradient(to right, #ff3d00, #ff9100);
            color: white;
        }
        
        .alarm-off {
            background: linear-gradient(to right, #616161, #9e9e9e);
            color: white;
        }
        
        .alarm-status {
            padding: 10px 15px;
            border-radius: 50px;
            font-weight: 600;
            margin-top: 10px;
            display: inline-block;
            font-size: 0.9rem;
            text-align: center;
            width: 100%;
            max-width: 400px;
        }
        
        .alarm-active {
            background: rgba(255, 61, 0, 0.2);
            color: #ffab91;
            animation: pulse 2s infinite;
        }
        
        .alarm-inactive {
            background: rgba(158, 158, 158, 0.2);
            color: #e0e0e0;
        }
        
        .status-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 15px;
            padding: 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }
        
        @media (min-width: 480px) {
            .status-container {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 15px;
                padding: 15px;
            }
        }
        
        .status-item {
            text-align: center;
            flex: 1;
        }
        
        .status-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: #bb86fc;
            margin-top: 5px;
            word-break: break-word;
            line-height: 1.3;
        }
        
        @media (min-width: 768px) {
            .status-value {
                font-size: 1.2rem;
            }
        }
        
        .notification {
            position: fixed;
            bottom: 15px;
            left: 15px;
            right: 15px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.95);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border-left: 5px solid #bb86fc;
            display: none;
            z-index: 1000;
            animation: slideIn 0.5s ease;
            max-width: 500px;
            margin: 0 auto;
        }
        
        @media (min-width: 768px) {
            .notification {
                bottom: 30px;
                right: 30px;
                left: auto;
                max-width: 350px;
            }
        }
        
        @keyframes slideIn {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .notification h3 {
            color: #bb86fc;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        
        .notification-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
        }
        
        .alarm-sound {
            display: none;
        }
        
        .loading {
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #bb86fc;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.8rem;
            opacity: 0.8;
            line-height: 1.4;
        }
        
        .selection-path {
            font-size: 0.85rem;
            color: #bb86fc;
            margin-bottom: 10px;
            padding: 8px 12px;
            background: rgba(187, 134, 252, 0.1);
            border-radius: 8px;
            display: none;
            word-wrap: break-word;
            line-height: 1.4;
        }
        
        .location-info {
            margin-top: 15px;
            padding: 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            display: none;
        }
        
        .location-details {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 10px;
        }
        
        @media (min-width: 480px) {
            .location-details {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }
        }
        
        .location-item {
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            font-size: 0.85rem;
            word-break: break-word;
        }
        
        .location-label {
            color: #bb86fc;
            font-weight: 600;
            margin-bottom: 3px;
            font-size: 0.8rem;
        }
        
        .distance-indicator {
            height: 10px;
            background: linear-gradient(to right, #00c853, #ffeb3b, #ff3d00);
            border-radius: 5px;
            margin-top: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .distance-progress {
            height: 100%;
            background: #bb86fc;
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 5px;
        }
        
        .distance-marker {
            position: absolute;
            height: 15px;
            width: 2px;
            background: white;
            top: -2px;
        }
        
        .distance-marker-200 {
            left: 80%;
        }
        
        .distance-marker-100 {
            left: 90%;
        }
        
        .distance-marker-50 {
            left: 95%;
        }
        
        .distance-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.65rem;
            margin-top: 5px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .map-container {
            margin-top: 15px;
            border-radius: 10px;
            overflow: hidden;
            height: 200px;
            background: rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        @media (min-width: 768px) {
            .map-container {
                height: 250px;
            }
        }
        
        .map-placeholder {
            text-align: center;
            padding: 15px;
        }
        
        .map-placeholder i {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #bb86fc;
        }
        
        .distance-warning {
            color: #ff3d00;
            font-weight: bold;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .auto-monitoring-btn {
            background: linear-gradient(to right, #2196F3, #21CBF3);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.9rem;
            margin-top: 15px;
            width: 100%;
            touch-action: manipulation;
        }
        
        .auto-monitoring-btn:active {
            transform: scale(0.98);
        }
        
        @media (min-width: 768px) {
            .auto-monitoring-btn:hover {
                background: linear-gradient(to right, #1976D2, #2196F3);
            }
        }
        
        .monitoring-active {
            background: linear-gradient(to right, #4CAF50, #8BC34A) !important;
        }
        
        /* Melhorias específicas para telas muito pequenas */
        @media (max-width: 360px) {
            html {
                font-size: 15px;
            }
            
            .transport-btn {
                padding: 14px 15px;
                font-size: 1rem;
                min-height: 55px;
            }
            
            .action-btn {
                min-width: 100%;
                padding: 12px 20px;
            }
            
            .status-value {
                font-size: 1rem;
            }
        }
        
        /* Otimização para orientação paisagem */
        @media (max-height: 500px) and (orientation: landscape) {
            .options-container {
                max-height: 40vh;
            }
            
            .transport-btn {
                padding: 12px 15px;
                min-height: 50px;
            }
        }
        
        /* Prevenir zoom em inputs no iOS */
        @media (max-width: 768px) {
            input, select, textarea {
                font-size: 16px !important;
            }
        }
        
        /* Melhorias de toque para iOS */
        button, .option-item, .transport-btn {
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* Prevenir highlight azul em elementos tocáveis no iOS */
        button, a, input, select, textarea, .option-item {
            -webkit-tap-highlight-color: rgba(0,0,0,0);
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Melhorar legibilidade em diferentes telas */
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(135deg, #0d1b5e, #2a0c5c);
            }
        }
        
        /* Ajustes para telas muito grandes */
        @media (min-width: 1400px) {
            .container {
                max-width: 95%;
            }
        }
        
        /* Garantir que elementos não transbordem */
        .section, .options-container, .notification {
            max-width: 100%;
            box-sizing: border-box;
        }
        
        /* Ajustes para o painel de simulação */
        #simulationSpeed {
            width: 100%;
            margin-top: 8px;
            padding: 10px;
        }
        
        .simulation-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        @media (min-width: 480px) {
            .simulation-controls {
                flex-direction: row;
                align-items: center;
            }
            
            #simulationSpeed {
                flex: 1;
                margin-top: 0;
            }
        }
        
        /* Ajuste para o botão de fechar notificação em telas pequenas */
        @media (max-width: 767px) {
            .notification-close {
                width: 40px;
                height: 40px;
                font-size: 1.8rem;
            }
        }
        
        /* Ajuste para instruções em telas pequenas */
        .instructions-box {
            margin-top: 15px;
            padding: 12px;
            background: rgba(255, 61, 0, 0.1);
            border-radius: 10px;
            font-size: 0.85rem;
        }
        
        .instructions-box h4 {
            font-size: 1rem;
            margin-bottom: 8px;
            color: #ffab91;
        }
        
        .instructions-box p {
            margin-bottom: 6px;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-map-marked-alt"></i> Sistema de Transporte Inteligente</h1>
            <p class="subtitle">Encontre estações de trem e metrô, cadastre endereços e receba alertas de proximidade (200m)</p>
        </header>
        
        <div class="main-content">
            <div class="section">
                <h2 class="section-title"><i class="fas fa-train"></i> Opções de Transporte</h2>
                
                <div id="selectionPath" class="selection-path"></div>
                
                <div class="buttons-container">
                    <button class="transport-btn" id="cptmBtn">
                        <div class="btn-content">
                            <i class="fas fa-train"></i>
                            <span>CPTM (Trens Metropolitanos)</span>
                        </div>
                        <div class="btn-arrow"><i class="fas fa-chevron-right"></i></div>
                    </button>
                    
                    <button class="transport-btn" id="metroBtn">
                        <div class="btn-content">
                            <i class="fas fa-subway"></i>
                            <span>Metrô</span>
                        </div>
                        <div class="btn-arrow"><i class="fas fa-chevron-right"></i></div>
                    </button>
                    
                    <button class="transport-btn" id="addressBtn">
                        <div class="btn-content">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>Cadastrar Endereço</span>
                        </div>
                        <div class="btn-arrow"><i class="fas fa-chevron-right"></i></div>
                    </button>
                </div>
                
                <!-- Container para linhas do Metrô -->
                <div id="metroLines" class="options-container">
                    <h3>Linhas do Metrô de São Paulo</h3>
                    <div class="option-item line-item" data-type="metro" data-line="Linha 1-Azul">
                        <div class="line-color" style="background-color: #005CA9;"></div>
                        <div>
                            <strong>Linha 1-Azul</strong>
                            <div>Tucuruvi ↔ Jabaquara</div>
                        </div>
                    </div>
                    <div class="option-item line-item" data-type="metro" data-line="Linha 2-Verde">
                        <div class="line-color" style="background-color: #00AA5B;"></div>
                        <div>
                            <strong>Linha 2-Verde</strong>
                            <div>Vila Madalena ↔ Vila Prudente</div>
                        </div>
                    </div>
                    <div class="option-item line-item" data-type="metro" data-line="Linha 3-Vermelha">
                        <div class="line-color" style="background-color: #EE3F23;"></div>
                        <div>
                            <strong>Linha 3-Vermelha</strong>
                            <div>Corinthians-Itaquera ↔ Palmeiras-Barra Funda</div>
                        </div>
                    </div>
                    <div class="option-item line-item" data-type="metro" data-line="Linha 4-Amarela">
                        <div class="line-color" style="background-color: #FFD100;"></div>
                        <div>
                            <strong>Linha 4-Amarela</strong>
                            <div>Luz ↔ Vila Sônia</div>
                        </div>
                    </div>
                    <div class="option-item line-item" data-type="metro" data-line="Linha 5-Lilás">
                        <div class="line-color" style="background-color: #8B499A;"></div>
                        <div>
                            <strong>Linha 5-Lilás</strong>
                            <div>Capão Redondo ↔ Chácara Klabin</div>
                        </div>
                    </div>
                </div>
                
                <!-- Container para estações do Metrô -->
                <div id="metroStations" class="options-container"></div>
                
                <!-- Container para linhas da CPTM -->
                <div id="cptmLines" class="options-container">
                    <h3>Linhas da CPTM (Trens Metropolitanos)</h3>
                    <div class="option-item line-item" data-type="cptm" data-line="Linha 7-Rubi">
                        <div class="line-color" style="background-color: #A60C1E;"></div>
                        <div>
                            <strong>Linha 7-Rubi</strong>
                            <div>Luz ↔ Francisco Morato / Jundiaí</div>
                        </div>
                    </div>
                    <div class="option-item line-item" data-type="cptm" data-line="Linha 8-Diamante">
                        <div class="line-color" style="background-color: #00A65A;"></div>
                        <div>
                            <strong>Linha 8-Diamante</strong>
                            <div>Júlio Prestes ↔ Itapevi / Amador Bueno</div>
                        </div>
                    </div>
                    <div class="option-item line-item" data-type="cptm" data-line="Linha 9-Esmeralda">
                        <div class="line-color" style="background-color: #0C9444;"></div>
                        <div>
                            <strong>Linha 9-Esmeralda</strong>
                            <div>Osasco ↔ Grajaú</div>
                        </div>
                    </div>
                    <div class="option-item line-item" data-type="cptm" data-line="Linha 10-Turquesa">
                        <div class="line-color" style="background-color: #0D7AB8;"></div>
                        <div>
                            <strong>Linha 10-Turquesa</strong>
                            <div>Luz ↔ Rio Grande da Serra</div>
                        </div>
                    </div>
                    <div class="option-item line-item" data-type="cptm" data-line="Linha 11-Coral">
                        <div class="line-color" style="background-color: #F58220;"></div>
                        <div>
                            <strong>Linha 11-Coral</strong>
                            <div>Luz ↔ Estudantes</div>
                        </div>
                    </div>
                </div>
                
                <!-- Container para estações da CPTM -->
                <div id="cptmStations" class="options-container"></div>
                
                <!-- Formulário de endereço -->
                <div id="addressForm" class="address-form" style="display: none;">
                    <div class="form-row">
                        <div class="input-group">
                            <label for="cep">CEP</label>
                            <input type="text" id="cep" maxlength="9" placeholder="00000-000">
                            <small>Digite o CEP para preencher automaticamente</small>
                        </div>
                        <div class="input-group">
                            <label for="numero">Número</label>
                            <input type="text" id="numero" placeholder="Número do endereço">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="input-group">
                            <label for="rua">Rua</label>
                            <input type="text" id="rua" placeholder="Rua" readonly>
                        </div>
                        <div class="input-group">
                            <label for="bairro">Bairro</label>
                            <input type="text" id="bairro" placeholder="Bairro" readonly>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="input-group">
                            <label for="cidade">Município</label>
                            <input type="text" id="cidade" placeholder="Cidade" readonly>
                        </div>
                        <div class="input-group">
                            <label for="estado">Estado</label>
                            <input type="text" id="estado" placeholder="Estado" readonly>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label for="complemento">Complemento (opcional)</label>
                        <input type="text" id="complemento" placeholder="Apartamento, bloco, etc.">
                    </div>
                </div>
                
                <!-- Informações de localização da estação -->
                <div id="locationInfo" class="location-info">
                    <h3><i class="fas fa-map-pin"></i> Localização da Estação</h3>
                    <div class="location-details">
                        <div class="location-item">
                            <div class="location-label">Latitude</div>
                            <div id="stationLat">-</div>
                        </div>
                        <div class="location-item">
                            <div class="location-label">Longitude</div>
                            <div id="stationLng">-</div>
                        </div>
                        <div class="location-item">
                            <div class="location-label">Endereço</div>
                            <div id="stationAddress">-</div>
                        </div>
                        <div class="location-item">
                            <div class="location-label">Distância Atual</div>
                            <div id="realDistance">-</div>
                        </div>
                    </div>
                    
                    <div class="distance-indicator">
                        <div class="distance-progress" id="distanceProgress"></div>
                        <div class="distance-marker distance-marker-200" title="200 metros"></div>
                        <div class="distance-marker distance-marker-100" title="100 metros"></div>
                        <div class="distance-marker distance-marker-50" title="50 metros"></div>
                    </div>
                    <div class="distance-labels">
                        <span>1000m</span>
                        <span>500m</span>
                        <span>200m</span>
                        <span>100m</span>
                        <span>50m</span>
                        <span>0m</span>
                    </div>
                    
                    <div class="map-container">
                        <div class="map-placeholder" id="mapPlaceholder">
                            <i class="fas fa-map"></i>
                            <p>Mapa da localização da estação</p>
                            <p id="mapCoordinates">Coordenadas: -</p>
                        </div>
                    </div>
                    
                    <button class="auto-monitoring-btn" id="startMonitoring">
                        <i class="fas fa-satellite-dish"></i> Iniciar Monitoramento em Tempo Real
                    </button>
                </div>
                
                <div class="action-buttons">
                    <button class="action-btn confirm-btn" id="confirmBtn">
                        <i class="fas fa-check-circle"></i> Confirmar Seleção
                    </button>
                </div>
            </div>
            
            <div class="section">
                <h2 class="section-title"><i class="fas fa-info-circle"></i> Status do Sistema</h2>
                
                <div class="status-container">
                    <div class="status-item">
                        <div>Tipo de Transporte</div>
                        <div class="status-value" id="transportType">Nenhum</div>
                    </div>
                    <div class="status-item">
                        <div>Estação/Destino</div>
                        <div class="status-value" id="selectedStation">Nenhum</div>
                    </div>
                    <div class="status-item">
                        <div>Distância Atual</div>
                        <div class="status-value" id="currentDistance">-</div>
                    </div>
                </div>
                
                <div class="status-container">
                    <div class="status-item">
                        <div>Localização do Usuário</div>
                        <div class="status-value" id="currentLocation">Obtendo...</div>
                    </div>
                    <div class="status-item">
                        <div>Linha Selecionada</div>
                        <div class="status-value" id="selectedLine">Nenhuma</div>
                    </div>
                </div>
                
                <div class="status-container">
                    <div class="status-item">
                        <div>Status do Alarme</div>
                        <div class="status-value" id="alarmDistanceStatus">Desativado</div>
                    </div>
                    <div class="status-item">
                        <div>Próximo Alerta</div>
                        <div class="status-value" id="nextAlertAt">200 metros</div>
                    </div>
                </div>
                
                <h2 class="section-title"><i class="fas fa-bell"></i> Configuração do Alarme</h2>
                
                <div class="alarm-controls">
                    <button class="alarm-btn alarm-on" id="enableAlarm">
                        <i class="fas fa-bell"></i> Ativar Alarme (200m)
                    </button>
                    
                    <button class="alarm-btn alarm-off" id="disableAlarm">
                        <i class="fas fa-bell-slash"></i> Desativar Alarme
                    </button>
                    
                    <select id="alarmSound">
                        <option value="alarm1">Alarme Clássico</option>
                        <option value="alarm2">Alarme Moderno</option>
                        <option value="alarm3">Alarme Melódico</option>
                        <option value="alarm4">Alerta de Trem</option>
                    </select>
                </div>
                
                <div class="alarm-status alarm-inactive" id="alarmStatus">
                    <i class="fas fa-bell-slash"></i> Alarme Desativado - Será acionado a 200m
                </div>
                
                <div class="instructions-box">
                    <h4><i class="fas fa-exclamation-triangle"></i> Instruções:</h4>
                    <p>1. Selecione uma estação ou endereço</p>
                    <p>2. Ative o alarme</p>
                    <p>3. O sistema monitorará sua localização em tempo real</p>
                    <p>4. <strong class="distance-warning">Alarme acionado automaticamente a 200 metros</strong></p>
                </div>
            </div>
            
            <div class="section alarm-section">
                <h2 class="section-title"><i class="fas fa-map"></i> Simulação de Viagem</h2>
                <p>Clique no botão abaixo para simular uma viagem e testar o sistema de alerta de 200m</p>
                
                <div class="alarm-controls simulation-controls">
                    <button class="alarm-btn alarm-on" id="simulateTrip">
                        <i class="fas fa-play-circle"></i> Simular Aproximação
                    </button>
                    
                    <button class="alarm-btn alarm-off" id="stopSimulation">
                        <i class="fas fa-stop-circle"></i> Parar Simulação
                    </button>
                </div>
                
                <select id="simulationSpeed">
                    <option value="1000">Lenta (1x)</option>
                    <option value="500">Normal (2x)</option>
                    <option value="250">Rápida (4x)</option>
                    <option value="100">Muito Rápida (10x)</option>
                </select>
                
                <div id="simulationStatus" style="margin-top: 15px; font-style: italic; font-size: 0.9rem;">
                    Clique em "Simular Aproximação" para testar o alerta de 200m
                </div>
            </div>
        </div>
        
        <footer>
            <p>Sistema de Transporte Inteligente &copy; 2023 - Desenvolvido para alertas de proximidade</p>
            <p>O sistema alerta quando você está a 200 metros do destino selecionado</p>
        </footer>
    </div>
    
    <!-- Notificação de alerta -->
    <div class="notification" id="notification">
        <button class="notification-close" id="closeNotification">&times;</button>
        <h3><i class="fas fa-exclamation-triangle"></i> Alerta de Proximidade!</h3>
        <p id="notificationMessage">Você está se aproximando do seu destino!</p>
        <p><strong>Distância atual:</strong> <span id="notificationDistance">200 metros</span></p>
        <p><strong>Destino:</strong> <span id="notificationDestination">-</span></p>
        <p><small>Alarme acionado automaticamente</small></p>
    </div>
    
    <!-- Elementos de áudio para os alarmes -->
    <audio id="alarm1" class="alarm-sound" loop>
        <source src="https://assets.mixkit.co/active_storage/sfx/286/286-preview.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="alarm2" class="alarm-sound" loop>
        <source src="https://assets.mixkit.co/active_storage/sfx/250/250-preview.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="alarm3" class="alarm-sound" loop>
        <source src="https://assets.mixkit.co/active_storage/sfx/255/255-preview.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="alarm4" class="alarm-sound" loop>
        <source src="https://assets.mixkit.co/active_storage/sfx/269/269-preview.mp3" type="audio/mpeg">
    </audio>
    
    <script>
        // Código JavaScript permanece EXATAMENTE o mesmo
        // Elementos do DOM
        const cptmBtn = document.getElementById('cptmBtn');
        const metroBtn = document.getElementById('metroBtn');
        const addressBtn = document.getElementById('addressBtn');
        const cptmLines = document.getElementById('cptmLines');
        const cptmStations = document.getElementById('cptmStations');
        const metroLines = document.getElementById('metroLines');
        const metroStations = document.getElementById('metroStations');
        const addressForm = document.getElementById('addressForm');
        const confirmBtn = document.getElementById('confirmBtn');
        const enableAlarmBtn = document.getElementById('enableAlarm');
        const disableAlarmBtn = document.getElementById('disableAlarm');
        const alarmStatus = document.getElementById('alarmStatus');
        const alarmSoundSelect = document.getElementById('alarmSound');
        const simulateTripBtn = document.getElementById('simulateTrip');
        const stopSimulationBtn = document.getElementById('stopSimulation');
        const notification = document.getElementById('notification');
        const closeNotificationBtn = document.getElementById('closeNotification');
        const notificationMessage = document.getElementById('notificationMessage');
        const notificationDistance = document.getElementById('notificationDistance');
        const notificationDestination = document.getElementById('notificationDestination');
        const selectionPath = document.getElementById('selectionPath');
        const locationInfo = document.getElementById('locationInfo');
        const stationLat = document.getElementById('stationLat');
        const stationLng = document.getElementById('stationLng');
        const stationAddress = document.getElementById('stationAddress');
        const realDistance = document.getElementById('realDistance');
        const distanceProgress = document.getElementById('distanceProgress');
        const mapPlaceholder = document.getElementById('mapPlaceholder');
        const mapCoordinates = document.getElementById('mapCoordinates');
        const startMonitoringBtn = document.getElementById('startMonitoring');
        const simulationSpeed = document.getElementById('simulationSpeed');
        
        // Elementos de status
        const transportTypeEl = document.getElementById('transportType');
        const selectedStationEl = document.getElementById('selectedStation');
        const selectedLineEl = document.getElementById('selectedLine');
        const currentDistanceEl = document.getElementById('currentDistance');
        const currentLocationEl = document.getElementById('currentLocation');
        const simulationStatusEl = document.getElementById('simulationStatus');
        const alarmDistanceStatus = document.getElementById('alarmDistanceStatus');
        const nextAlertAt = document.getElementById('nextAlertAt');
        
        // Elementos do formulário de endereço
        const cepInput = document.getElementById('cep');
        const ruaInput = document.getElementById('rua');
        const bairroInput = document.getElementById('bairro');
        const cidadeInput = document.getElementById('cidade');
        const estadoInput = document.getElementById('estado');
        const numeroInput = document.getElementById('numero');
        const complementoInput = document.getElementById('complemento');
        
        // Dados das estações por linha com coordenadas reais aproximadas em São Paulo
        const metroStationsData = {
            "Linha 1-Azul": [
                {name: "Tucuruvi", lat: -23.4804, lng: -46.6028, address: "Av. Dr. Antonio Maria Laet, Tucuruvi"},
                {name: "Parada Inglesa", lat: -23.4894, lng: -46.6094, address: "Av. Dr. Antonio Maria Laet, Parada Inglesa"},
                {name: "Jardim São Paulo", lat: -23.4975, lng: -46.6161, address: "Av. Leôncio de Magalhães, Jardim São Paulo"},
                {name: "Santana", lat: -23.5056, lng: -46.6228, address: "Av. Cruzeiro do Sul, Santana"},
                {name: "Carandiru", lat: -23.5137, lng: -46.6295, address: "Av. Cruzeiro do Sul, Carandiru"},
                {name: "Portuguesa-Tietê", lat: -23.5218, lng: -46.6362, address: "Av. Cruzeiro do Sul, Portuguesa-Tietê"},
                {name: "Armênia", lat: -23.5299, lng: -46.6429, address: "Av. Cruzeiro do Sul, Armênia"},
                {name: "Tiradentes", lat: -23.5380, lng: -46.6496, address: "Av. Tiradentes, Luz"},
                {name: "Luz", lat: -23.5350, lng: -46.6350, address: "Praça da Luz, Luz"},
                {name: "São Bento", lat: -23.5431, lng: -46.6340, address: "Largo São Bento, Centro"},
                {name: "Sé", lat: -23.5505, lng: -46.6333, address: "Praça da Sé, Sé"},
                {name: "Liberdade", lat: -23.5570, lng: -46.6350, address: "Praça da Liberdade, Liberdade"},
                {name: "São Joaquim", lat: -23.5635, lng: -46.6367, address: "Rua São Joaquim, Liberdade"},
                {name: "Vergueiro", lat: -23.5700, lng: -46.6384, address: "Av. Vergueiro, Liberdade"},
                {name: "Paraíso", lat: -23.5765, lng: -46.6401, address: "Rua Vergueiro, Paraíso"},
                {name: "Ana Rosa", lat: -23.5830, lng: -46.6418, address: "Av. Vergueiro, Vila Mariana"},
                {name: "Vila Mariana", lat: -23.5895, lng: -46.6435, address: "Av. Brigadeiro Luís Antônio, Vila Mariana"},
                {name: "Santa Cruz", lat: -23.5960, lng: -46.6452, address: "Rua Domingos de Morais, Vila Mariana"},
                {name: "Praça da Árvore", lat: -23.6025, lng: -46.6469, address: "Rua Loefgren, Vila Mariana"},
                {name: "Saúde", lat: -23.6090, lng: -46.6486, address: "Av. Jabaquara, Saúde"},
                {name: "São Judas", lat: -23.6155, lng: -46.6503, address: "Av. Jabaquara, São Judas"},
                {name: "Conceição", lat: -23.6220, lng: -46.6520, address: "Av. Engenheiro Armando de Arruda Pereira, Jabaquara"},
                {name: "Jabaquara", lat: -23.6285, lng: -46.6537, address: "Av. Engenheiro Armando de Arruda Pereira, Jabaquara"}
            ],
            "Linha 2-Verde": [
                {name: "Vila Madalena", lat: -23.5469, lng: -46.6938, address: "Praça Doutor João Mendes, Vila Madalena"},
                {name: "Sumaré", lat: -23.5480, lng: -46.6770, address: "Rua Doutor César, Sumaré"},
                {name: "Clínicas", lat: -23.5550, lng: -46.6700, address: "Av. Dr. Enéas Carvalho de Aguiar, Cerqueira César"},
                {name: "Consolação", lat: -23.5530, lng: -46.6580, address: "Rua da Consolação, Consolação"},
                {name: "Trianon-Masp", lat: -23.5610, lng: -46.6550, address: "Av. Paulista, Bela Vista"},
                {name: "Brigadeiro", lat: -23.5680, lng: -46.6520, address: "Av. Brigadeiro Luís Antônio, Bela Vista"},
                {name: "Paraíso", lat: -23.5765, lng: -46.6401, address: "Rua Vergueiro, Paraíso"},
                {name: "Ana Rosa", lat: -23.5830, lng: -46.6418, address: "Av. Vergueiro, Vila Mariana"},
                {name: "Chácara Klabin", lat: -23.5900, lng: -46.6300, address: "Rua Doutor César, Chácara Klabin"},
                {name: "Santos-Imigrantes", lat: -23.5970, lng: -46.6250, address: "Av. dos Imigrantes, Vila Mariana"},
                {name: "Alto do Ipiranga", lat: -23.6040, lng: -46.6200, address: "Av. do Estado, Ipiranga"},
                {name: "Sacomã", lat: -23.6110, lng: -46.6150, address: "Av. do Estado, Sacomã"},
                {name: "Tamanduateí", lat: -23.6180, lng: -46.6100, address: "Av. do Estado, Tamanduateí"},
                {name: "Vila Prudente", lat: -23.6250, lng: -46.6050, address: "Av. do Estado, Vila Prudente"}
            ]
        };
        
        const cptmStationsData = {
            "Linha 7-Rubi": [
                {name: "Luz", lat: -23.5350, lng: -46.6350, address: "Praça da Luz, Luz"},
                {name: "Barra Funda", lat: -23.5260, lng: -46.6670, address: "Av. Marquês de São Vicente, Barra Funda"},
                {name: "Água Branca", lat: -23.5320, lng: -46.6800, address: "Rua General Olímpio da Silveira, Água Branca"},
                {name: "Lapa", lat: -23.5220, lng: -46.7070, address: "Rua Guaicurus, Lapa"},
                {name: "Domingos de Moraes", lat: -23.5300, lng: -46.7150, address: "Rua Domingos de Moraes, Vila Leopoldina"},
                {name: "Imperatriz Leopoldina", lat: -23.5380, lng: -46.7230, address: "Rua Imperatriz Leopoldina, Vila Leopoldina"},
                {name: "Presidente Altino", lat: -23.5400, lng: -46.7380, address: "Av. dos Autonomistas, Osasco"},
                {name: "Osasco", lat: -23.5450, lng: -46.7500, address: "Av. dos Autonomistas, Osasco"},
                {name: "Comandante Sampaio", lat: -23.5500, lng: -46.7620, address: "Av. dos Autonomistas, Osasco"},
                {name: "Quitaúna", lat: -23.5550, lng: -46.7740, address: "Av. dos Autonomistas, Osasco"}
            ],
            "Linha 8-Diamante": [
                {name: "Júlio Prestes", lat: -23.5340, lng: -46.6410, address: "Praça Júlio Prestes, Campos Elíseos"},
                {name: "Palmeiras-Barra Funda", lat: -23.5260, lng: -46.6670, address: "Av. Marquês de São Vicente, Barra Funda"},
                {name: "Lapa", lat: -23.5220, lng: -46.7070, address: "Rua Guaicurus, Lapa"},
                {name: "Domingos de Moraes", lat: -23.5300, lng: -46.7150, address: "Rua Domingos de Moraes, Vila Leopoldina"},
                {name: "Imperatriz Leopoldina", lat: -23.5380, lng: -46.7230, address: "Rua Imperatriz Leopoldina, Vila Leopoldina"},
                {name: "Presidente Altino", lat: -23.5400, lng: -46.7380, address: "Av. dos Autonomistas, Osasco"},
                {name: "Osasco", lat: -23.5450, lng: -46.7500, address: "Av. dos Autonomistas, Osasco"},
                {name: "Comandante Sampaio", lat: -23.5500, lng: -46.7620, address: "Av. dos Autonomistas, Osasco"},
                {name: "Quitaúna", lat: -23.5550, lng: -46.7740, address: "Av. dos Autonomistas, Osasco"}
            ],
            "Linha 9-Esmeralda": [
                {name: "Osasco", lat: -23.5450, lng: -46.7500, address: "Av. dos Autonomistas, Osasco"},
                {name: "Presidente Altino", lat: -23.5400, lng: -46.7380, address: "Av. dos Autonomistas, Osasco"},
                {name: "Imperatriz Leopoldina", lat: -23.5380, lng: -46.7230, address: "Rua Imperatriz Leopoldina, Vila Leopoldina"},
                {name: "Domingos de Moraes", lat: -23.5300, lng: -46.7150, address: "Rua Domingos de Moraes, Vila Leopoldina"},
                {name: "Lapa", lat: -23.5220, lng: -46.7070, address: "Rua Guaicurus, Lapa"},
                {name: "Palmeiras-Barra Funda", lat: -23.5260, lng: -46.6670, address: "Av. Marquês de São Vicente, Barra Funda"},
                {name: "Rebouças", lat: -23.5700, lng: -46.6900, address: "Av. Rebouças, Pinheiros"},
                {name: "Cidade Jardim", lat: -23.5900, lng: -46.6950, address: "Av. Cidade Jardim, Jardim Europa"},
                {name: "Vila Olímpia", lat: -23.5950, lng: -46.6850, address: "Rua Olimpíadas, Vila Olímpia"},
                {name: "Berrini", lat: -23.6000, lng: -46.6950, address: "Av. Engenheiro Luís Carlos Berrini, Brooklin"}
            ],
            "Linha 10-Turquesa": [
                {name: "Luz", lat: -23.5350, lng: -46.6350, address: "Praça da Luz, Luz"},
                {name: "Brás", lat: -23.5450, lng: -46.6150, address: "Av. Rangel Pestana, Brás"},
                {name: "Mooca", lat: -23.5500, lng: -46.6000, address: "Rua da Mooca, Mooca"},
                {name: "Ipiranga", lat: -23.5850, lng: -46.6100, address: "Av. do Estado, Ipiranga"},
                {name: "São Caetano do Sul", lat: -23.6100, lng: -46.5800, address: "Av. Goiás, São Caetano do Sul"},
                {name: "Utinga", lat: -23.6250, lng: -46.5500, address: "Av. Goiás, Santo André"},
                {name: "Prefeito Saladino", lat: -23.6400, lng: -46.5300, address: "Av. Portugal, Santo André"},
                {name: "São Bernardo", lat: -23.6550, lng: -46.5500, address: "Av. Pereira Barreto, São Bernardo do Campo"},
                {name: "Rio Grande da Serra", lat: -23.7450, lng: -46.4000, address: "Rua da Estação, Rio Grande da Serra"}
            ]
        };
        
        // Variáveis do sistema
        let selectedOption = null;
        let alarmEnabled = false;
        let simulationInterval = null;
        let monitoringInterval = null;
        let currentRealDistance = 1000; // Distância inicial em metros
        let userLocation = null;
        let stationLocation = null;
        let currentSelectionStep = 'none';
        let selectedLine = null;
        let isMonitoring = false;
        
        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Obter localização do usuário
            getUserLocation();
            
            // Configurar eventos dos botões de transporte
            cptmBtn.addEventListener('click', () => showTransportLines('cptm'));
            metroBtn.addEventListener('click', () => showTransportLines('metro'));
            addressBtn.addEventListener('click', () => showOptions('address'));
            
            // Configurar botão de confirmação
            confirmBtn.addEventListener('click', confirmSelection);
            
            // Configurar alarme
            enableAlarmBtn.addEventListener('click', enableAlarm);
            disableAlarmBtn.addEventListener('click', disableAlarm);
            
            // Configurar simulação
            simulateTripBtn.addEventListener('click', startSimulation);
            stopSimulationBtn.addEventListener('click', stopSimulation);
            
            // Configurar notificação
            closeNotificationBtn.addEventListener('click', () => {
                notification.style.display = 'none';
                stopAllAlarms();
            });
            
            // Configurar busca por CEP
            cepInput.addEventListener('input', formatCEP);
            cepInput.addEventListener('blur', fetchAddressByCEP);
            
            // Configurar botão de monitoramento
            startMonitoringBtn.addEventListener('click', toggleMonitoring);
            
            // Configurar seleção automática ao clicar em endereço
            addressBtn.addEventListener('click', function() {
                selectedOption = { type: 'endereço', line: 'Endereço Cadastrado', station: 'Meu Endereço' };
                transportTypeEl.textContent = 'Endereço';
                selectedLineEl.textContent = 'Endereço Cadastrado';
                selectedStationEl.textContent = 'Aguardando cadastro';
            });
        });
        
        // Função para mostrar linhas de transporte
        function showTransportLines(transportType) {
            // Esconder todos os containers
            cptmLines.style.display = 'none';
            cptmStations.style.display = 'none';
            metroLines.style.display = 'none';
            metroStations.style.display = 'none';
            addressForm.style.display = 'none';
            locationInfo.style.display = 'none';
            
            // Limpar seleção
            document.querySelectorAll('.option-item').forEach(el => el.classList.remove('selected'));
            selectedOption = null;
            selectedLine = null;
            stationLocation = null;
            
            // Atualizar caminho de seleção
            selectionPath.style.display = 'block';
            
            if (transportType === 'cptm') {
                currentSelectionStep = 'cptm-lines';
                cptmLines.style.display = 'block';
                selectionPath.innerHTML = '<i class="fas fa-train"></i> CPTM > Selecione uma linha';
                
                // Configurar seleção de linhas da CPTM
                document.querySelectorAll('#cptmLines .option-item').forEach(item => {
                    item.addEventListener('click', function() {
                        document.querySelectorAll('#cptmLines .option-item').forEach(el => el.classList.remove('selected'));
                        this.classList.add('selected');
                        selectedLine = this.getAttribute('data-line');
                        selectedLineEl.textContent = selectedLine;
                        showStationsForLine('cptm', selectedLine);
                    });
                });
                
            } else if (transportType === 'metro') {
                currentSelectionStep = 'metro-lines';
                metroLines.style.display = 'block';
                selectionPath.innerHTML = '<i class="fas fa-subway"></i> Metrô > Selecione uma linha';
                
                // Configurar seleção de linhas do Metrô
                document.querySelectorAll('#metroLines .option-item').forEach(item => {
                    item.addEventListener('click', function() {
                        document.querySelectorAll('#metroLines .option-item').forEach(el => el.classList.remove('selected'));
                        this.classList.add('selected');
                        selectedLine = this.getAttribute('data-line');
                        selectedLineEl.textContent = selectedLine;
                        showStationsForLine('metro', selectedLine);
                    });
                });
            }
            
            // Atualizar status
            transportTypeEl.textContent = transportType === 'cptm' ? 'CPTM' : 'Metrô';
            selectedStationEl.textContent = 'Nenhuma';
        }
        
        // Função para mostrar estações de uma linha
        function showStationsForLine(transportType, line) {
            // Esconder containers de linhas
            if (transportType === 'cptm') {
                cptmLines.style.display = 'none';
                cptmStations.style.display = 'block';
                currentSelectionStep = 'cptm-stations';
                selectionPath.innerHTML = `<i class="fas fa-train"></i> CPTM > ${line} > Selecione uma estação`;
                
                // Limpar estações anteriores
                cptmStations.innerHTML = `
                    <button class="back-btn" id="backToCptmLines">
                        <i class="fas fa-arrow-left"></i> Voltar para linhas
                    </button>
                    <h3>Estações da ${line}</h3>
                `;
                
                // Adicionar botão voltar
                document.getElementById('backToCptmLines').addEventListener('click', () => {
                    showTransportLines('cptm');
                });
                
                // Adicionar estações
                const stations = cptmStationsData[line] || [];
                stations.forEach(station => {
                    const stationItem = document.createElement('div');
                    stationItem.className = 'option-item station-item';
                    stationItem.innerHTML = `
                        <div><strong>${station.name}</strong></div>
                        <div style="font-size: 0.8rem; opacity: 0.8;">${station.address}</div>
                    `;
                    stationItem.setAttribute('data-type', 'cptm');
                    stationItem.setAttribute('data-line', line);
                    stationItem.setAttribute('data-station', station.name);
                    stationItem.setAttribute('data-lat', station.lat);
                    stationItem.setAttribute('data-lng', station.lng);
                    stationItem.setAttribute('data-address', station.address);
                    
                    stationItem.addEventListener('click', function() {
                        document.querySelectorAll('#cptmStations .option-item').forEach(el => el.classList.remove('selected'));
                        this.classList.add('selected');
                        selectStation(transportType, line, station);
                    });
                    
                    cptmStations.appendChild(stationItem);
                });
                
            } else if (transportType === 'metro') {
                metroLines.style.display = 'none';
                metroStations.style.display = 'block';
                currentSelectionStep = 'metro-stations';
                selectionPath.innerHTML = `<i class="fas fa-subway"></i> Metrô > ${line} > Selecione uma estação`;
                
                // Limpar estações anteriores
                metroStations.innerHTML = `
                    <button class="back-btn" id="backToMetroLines">
                        <i class="fas fa-arrow-left"></i> Voltar para linhas
                    </button>
                    <h3>Estações da ${line}</h3>
                `;
                
                // Adicionar botão voltar
                document.getElementById('backToMetroLines').addEventListener('click', () => {
                    showTransportLines('metro');
                });
                
                // Adicionar estações
                const stations = metroStationsData[line] || [];
                stations.forEach(station => {
                    const stationItem = document.createElement('div');
                    stationItem.className = 'option-item station-item';
                    stationItem.innerHTML = `
                        <div><strong>${station.name}</strong></div>
                        <div style="font-size: 0.8rem; opacity: 0.8;">${station.address}</div>
                    `;
                    stationItem.setAttribute('data-type', 'metro');
                    stationItem.setAttribute('data-line', line);
                    stationItem.setAttribute('data-station', station.name);
                    stationItem.setAttribute('data-lat', station.lat);
                    stationItem.setAttribute('data-lng', station.lng);
                    stationItem.setAttribute('data-address', station.address);
                    
                    stationItem.addEventListener('click', function() {
                        document.querySelectorAll('#metroStations .option-item').forEach(el => el.classList.remove('selected'));
                        this.classList.add('selected');
                        selectStation(transportType, line, station);
                    });
                    
                    metroStations.appendChild(stationItem);
                });
            }
        }
        
        // Função para selecionar uma estação
        function selectStation(transportType, line, station) {
            selectedOption = {
                type: transportType,
                line: line,
                station: station.name
            };
            
            // Obter localização da estação
            stationLocation = {
                lat: station.lat,
                lng: station.lng,
                address: station.address
            };
            
            // Mostrar informações da localização
            showStationLocationInfo();
            
            // Calcular distância inicial
            if (userLocation) {
                currentRealDistance = calculateDistance(userLocation.lat, userLocation.lng, stationLocation.lat, stationLocation.lng);
                updateDistanceDisplay();
            }
            
            // Atualizar status
            transportTypeEl.textContent = transportType === 'cptm' ? 'CPTM' : 'Metrô';
            selectedLineEl.textContent = line;
            selectedStationEl.textContent = station.name;
        }
        
        // Função para mostrar informações da localização da estação
        function showStationLocationInfo() {
            locationInfo.style.display = 'block';
            
            // Preencher informações da estação
            stationLat.textContent = stationLocation.lat.toFixed(6);
            stationLng.textContent = stationLocation.lng.toFixed(6);
            stationAddress.textContent = stationLocation.address;
            
            // Atualizar mapa
            mapCoordinates.textContent = `Coordenadas: ${stationLocation.lat.toFixed(6)}, ${stationLocation.lng.toFixed(6)}`;
            
            // Calcular e mostrar distância atual
            if (userLocation) {
                const distance = calculateDistance(userLocation.lat, userLocation.lng, stationLocation.lat, stationLocation.lng);
                realDistance.textContent = `${Math.round(distance)} metros`;
                
                // Atualizar barra de progresso (invertida: 0% = longe, 100% = perto)
                const progress = Math.max(0, Math.min(100, 100 - (distance / 1000) * 100));
                distanceProgress.style.width = `${progress}%`;
                
                // Verificar se está a 200 metros ou menos
                if (distance <= 200 && alarmEnabled) {
                    triggerAlarm(distance);
                }
            }
        }
        
        // Função para calcular distância entre duas coordenadas (Haversine formula)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371000; // Raio da Terra em metros
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c; // Distância em metros
        }
        
        // Função para atualizar a exibição da distância
        function updateDistanceDisplay() {
            if (currentRealDistance >= 1000) {
                currentDistanceEl.textContent = `${(currentRealDistance / 1000).toFixed(2)} km`;
            } else {
                currentDistanceEl.textContent = `${Math.round(currentRealDistance)} metros`;
            }
            
            // Atualizar barra de progresso
            const progress = Math.max(0, Math.min(100, 100 - (currentRealDistance / 1000) * 100));
            distanceProgress.style.width = `${progress}%`;
            
            // Atualizar texto da distância real
            realDistance.textContent = `${Math.round(currentRealDistance)} metros`;
            
            // Verificar se está a 200 metros ou menos
            if (currentRealDistance <= 200 && alarmEnabled) {
                triggerAlarm(currentRealDistance);
            }
        }
        
        // Função para mostrar opções de endereço
        function showOptions(type) {
            // Esconder todos os containers
            cptmLines.style.display = 'none';
            cptmStations.style.display = 'none';
            metroLines.style.display = 'none';
            metroStations.style.display = 'none';
            addressForm.style.display = 'none';
            locationInfo.style.display = 'none';
            selectionPath.style.display = 'none';
            
            // Limpar seleção
            document.querySelectorAll('.option-item').forEach(el => el.classList.remove('selected'));
            selectedOption = null;
            selectedLine = null;
            stationLocation = null;
            
            // Mostrar o container correto
            if (type === 'address') {
                addressForm.style.display = 'block';
                transportTypeEl.textContent = 'Endereço';
                selectedLineEl.textContent = 'Endereço Cadastrado';
                selectedStationEl.textContent = 'Aguardando cadastro';
                currentSelectionStep = 'address';
            }
        }
        
        // Função para confirmar seleção
        function confirmSelection() {
            if (!selectedOption && currentSelectionStep !== 'address') {
                alert('Por favor, selecione uma estação primeiro!');
                return;
            }
            
            // Para endereço, validar se os campos foram preenchidos
            if (currentSelectionStep === 'address') {
                if (!ruaInput.value || !numeroInput.value) {
                    alert('Por favor, preencha o endereço completo!');
                    return;
                }
                
                selectedOption = {
                    type: 'endereço',
                    line: 'Endereço Cadastrado',
                    station: `${ruaInput.value}, ${numeroInput.value}`
                };
                
                selectedStationEl.textContent = `${ruaInput.value}, ${numeroInput.value}`;
                
                // Gerar localização de destino aleatória (para simulação)
                if (userLocation) {
                    stationLocation = {
                        lat: userLocation.lat + (Math.random() * 0.01 - 0.005),
                        lng: userLocation.lng + (Math.random() * 0.01 - 0.005),
                        address: `${ruaInput.value}, ${numeroInput.value}, ${bairroInput.value}, ${cidadeInput.value}`
                    };
                    
                    // Mostrar informações da localização
                    showStationLocationInfo();
                }
            }
            
            alert(`Seleção confirmada!\n\nTipo: ${selectedOption.type === 'cptm' ? 'CPTM' : selectedOption.type === 'metro' ? 'Metrô' : 'Endereço'}\nLinha: ${selectedOption.line}\nEstaçao/Destino: ${selectedOption.station}\n\nO sistema irá alertar quando você estiver a 200 metros do destino.`);
            
            // Atualizar status
            currentDistanceEl.textContent = `${Math.round(currentRealDistance)} metros`;
            
            // Se o alarme está ativado, mostrar status
            if (alarmEnabled) {
                alarmStatus.className = "alarm-status alarm-active";
                alarmStatus.innerHTML = '<i class="fas fa-bell"></i> Alarme Ativado - Você será alertado a 200 metros';
                alarmDistanceStatus.textContent = "Ativado (200m)";
            }
        }
        
        // Função para obter localização do usuário
        function getUserLocation() {
            if (navigator.geolocation) {
                currentLocationEl.innerHTML = '<span class="loading"></span> Obtendo localização...';
                
                // Usar geolocalização real do navegador
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        
                        currentLocationEl.innerHTML = `<i class="fas fa-map-marker-alt"></i> Lat: ${userLocation.lat.toFixed(6)}, Long: ${userLocation.lng.toFixed(6)}`;
                        
                        // Se já tem uma estação selecionada, calcular distância
                        if (stationLocation) {
                            currentRealDistance = calculateDistance(userLocation.lat, userLocation.lng, stationLocation.lat, stationLocation.lng);
                            updateDistanceDisplay();
                        }
                    },
                    (error) => {
                        console.error("Erro ao obter localização:", error);
                        // Usar localização simulada em São Paulo
                        userLocation = {
                            lat: -23.5505 + (Math.random() * 0.01 - 0.005),
                            lng: -46.6333 + (Math.random() * 0.01 - 0.005)
                        };
                        
                        currentLocationEl.innerHTML = `<i class="fas fa-map-marker-alt"></i> Lat: ${userLocation.lat.toFixed(6)}, Long: ${userLocation.lng.toFixed(6)} (simulado)`;
                    },
                    { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
                );
                
                // Atualizar localização periodicamente
                setInterval(() => {
                    if (navigator.geolocation && isMonitoring) {
                        navigator.geolocation.getCurrentPosition(
                            (position) => {
                                userLocation = {
                                    lat: position.coords.latitude,
                                    lng: position.coords.longitude
                                };
                                
                                currentLocationEl.innerHTML = `<i class="fas fa-map-marker-alt"></i> Lat: ${userLocation.lat.toFixed(6)}, Long: ${userLocation.lng.toFixed(6)}`;
                                
                                // Se já tem uma estação selecionada, calcular distância
                                if (stationLocation) {
                                    currentRealDistance = calculateDistance(userLocation.lat, userLocation.lng, stationLocation.lat, stationLocation.lng);
                                    updateDistanceDisplay();
                                }
                            },
                            (error) => {
                                console.error("Erro ao atualizar localização:", error);
                            },
                            { enableHighAccuracy: true, timeout: 5000 }
                        );
                    }
                }, 5000); // Atualizar a cada 5 segundos
                
            } else {
                currentLocationEl.textContent = "Geolocalização não suportada";
                // Usar localização padrão
                userLocation = { lat: -23.5505, lng: -46.6333 };
            }
        }
        
        // Função para ativar alarme
        function enableAlarm() {
            alarmEnabled = true;
            alarmStatus.className = "alarm-status alarm-active";
            alarmStatus.innerHTML = '<i class="fas fa-bell"></i> Alarme Ativado - Você será alertado a 200 metros';
            alarmDistanceStatus.textContent = "Ativado (200m)";
            
            if (selectedOption) {
                alert(`Alarme ativado! Você será alertado com som quando estiver a 200 metros de ${selectedOption.station}`);
            } else {
                alert('Alarme ativado! Selecione um destino para começar a receber alertas.');
            }
        }
        
        // Função para desativar alarme
        function disableAlarm() {
            alarmEnabled = false;
            alarmStatus.className = "alarm-status alarm-inactive";
            alarmStatus.innerHTML = '<i class="fas fa-bell-slash"></i> Alarme Desativado';
            alarmDistanceStatus.textContent = "Desativado";
            stopAllAlarms();
        }
        
        // Função para acionar o alarme
        function triggerAlarm(distance) {
            if (!alarmEnabled) return;
            
            const alarmType = alarmSoundSelect.value;
            const alarmAudio = document.getElementById(alarmType);
            
            // Parar todos os alarmes primeiro
            stopAllAlarms();
            
            // Tocar o alarme selecionado
            alarmAudio.currentTime = 0;
            alarmAudio.play().catch(e => console.log("Erro ao tocar alarme:", e));
            
            // Mostrar notificação
            notificationMessage.textContent = `Você está se aproximando do destino!`;
            notificationDistance.textContent = `${Math.round(distance)} metros`;
            notificationDestination.textContent = selectedOption ? selectedOption.station : 'Destino selecionado';
            notification.style.display = 'block';
            
            // Vibrar se suportado
            if (navigator.vibrate) {
                navigator.vibrate([500, 200, 500, 200, 500]);
            }
            
            // Atualizar status
            alarmDistanceStatus.innerHTML = `<span class="distance-warning">ALERTA! ${Math.round(distance)}m</span>`;
        }
        
        // Função para parar todos os alarmes
        function stopAllAlarms() {
            document.querySelectorAll('.alarm-sound').forEach(audio => {
                audio.pause();
                audio.currentTime = 0;
            });
        }
        
        // Função para iniciar monitoramento automático
        function toggleMonitoring() {
            if (!selectedOption) {
                alert('Por favor, selecione uma estação primeiro!');
                return;
            }
            
            if (!isMonitoring) {
                isMonitoring = true;
                startMonitoringBtn.innerHTML = '<i class="fas fa-stop-circle"></i> Parar Monitoramento';
                startMonitoringBtn.classList.add('monitoring-active');
                simulationStatusEl.innerHTML = '<i class="fas fa-satellite-dish"></i> Monitoramento ativo - Aguardando aproximação a 200m';
                
                alert('Monitoramento ativado! O sistema verificará sua localização automaticamente.');
            } else {
                isMonitoring = false;
                startMonitoringBtn.innerHTML = '<i class="fas fa-satellite-dish"></i> Iniciar Monitoramento em Tempo Real';
                startMonitoringBtn.classList.remove('monitoring-active');
                simulationStatusEl.innerHTML = 'Monitoramento desativado';
            }
        }
        
        // Função para iniciar simulação de viagem
        function startSimulation() {
            if (!selectedOption) {
                alert('Por favor, selecione e confirme um destino primeiro!');
                return;
            }
            
            if (simulationInterval) {
                clearInterval(simulationInterval);
            }
            
            // Resetar distância para simulação (começar a 1000m)
            currentRealDistance = 1000;
            updateDistanceDisplay();
            
            const speed = parseInt(simulationSpeed.value);
            simulationStatusEl.innerHTML = '<i class="fas fa-play-circle"></i> Simulação em andamento... Aproximando-se do destino';
            simulateTripBtn.disabled = true;
            stopSimulationBtn.disabled = false;
            
            // Iniciar simulação
            simulationInterval = setInterval(() => {
                // Reduzir distância gradualmente
                currentRealDistance -= Math.random() * 20 + 10; // Reduz 10-30 metros por intervalo
                
                if (currentRealDistance <= 0) {
                    currentRealDistance = 0;
                    clearInterval(simulationInterval);
                    simulationStatusEl.innerHTML = '<i class="fas fa-flag-checkered"></i> Você chegou ao destino!';
                    simulateTripBtn.disabled = false;
                    stopSimulationBtn.disabled = true;
                    
                    // Se chegou ao destino, parar alarmes
                    stopAllAlarms();
                    return;
                }
                
                // Atualizar display de distância
                updateDistanceDisplay();
                
                // Verificar se está a 200 metros ou menos
                if (currentRealDistance <= 200) {
                    simulationStatusEl.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ALERTA: Você está a ${Math.round(currentRealDistance)} metros do destino!`;
                    
                    // Se o alarme está ativado, tocar
                    if (alarmEnabled && currentRealDistance <= 200) {
                        triggerAlarm(currentRealDistance);
                    }
                } else if (currentRealDistance <= 500) {
                    simulationStatusEl.innerHTML = `<i class="fas fa-info-circle"></i> Aproximando-se do destino: ${Math.round(currentRealDistance)} metros`;
                }
            }, speed); // Atualizar no intervalo selecionado
        }
        
        // Função para parar simulação
        function stopSimulation() {
            if (simulationInterval) {
                clearInterval(simulationInterval);
                simulationInterval = null;
            }
            
            simulationStatusEl.innerHTML = 'Simulação interrompida';
            simulateTripBtn.disabled = false;
            stopSimulationBtn.disabled = true;
            stopAllAlarms();
            notification.style.display = 'none';
        }
        
        // Função para formatar CEP
        function formatCEP() {
            let cep = cepInput.value.replace(/\D/g, '');
            
            if (cep.length > 5) {
                cep = cep.substring(0, 5) + '-' + cep.substring(5, 8);
            }
            
            cepInput.value = cep;
        }
        
        // Função para buscar endereço pelo CEP
        function fetchAddressByCEP() {
            const cep = cepInput.value.replace(/\D/g, '');
            
            if (cep.length !== 8) {
                alert('CEP inválido! Digite um CEP com 8 dígitos.');
                return;
            }
            
            // Mostrar indicador de carregamento
            ruaInput.value = "Buscando...";
            bairroInput.value = "Buscando...";
            cidadeInput.value = "Buscando...";
            estadoInput.value = "Buscando...";
            
            // Simulação de busca de CEP
            setTimeout(() => {
                // Dados de exemplo para CEPs
                const cepExamples = {
                    '01001000': { logradouro: 'Praça da Sé', bairro: 'Sé', localidade: 'São Paulo', uf: 'SP' },
                    '01311000': { logradouro: 'Avenida Paulista', bairro: 'Bela Vista', localidade: 'São Paulo', uf: 'SP' },
                    '20040002': { logradouro: 'Rua Primeiro de Março', bairro: 'Centro', localidade: 'Rio de Janeiro', uf: 'RJ' },
                    '30130005': { logradouro: 'Rua da Bahia', bairro: 'Centro', localidade: 'Belo Horizonte', uf: 'MG' },
                    '40010000': { logradouro: 'Rua Chile', bairro: 'Centro', localidade: 'Salvador', uf: 'BA' },
                    '70040900': { logradouro: 'Eixo Monumental', bairro: 'Asa Sul', localidade: 'Brasília', uf: 'DF' }
                };
                
                // Usar exemplo se existir, caso contrário usar dados genéricos
                let endereco;
                
                if (cepExamples[cep]) {
                    endereco = cepExamples[cep];
                } else {
                    // Dados genéricos para qualquer CEP
                    const cidades = [
                        { cidade: 'São Paulo', uf: 'SP' },
                        { cidade: 'Rio de Janeiro', uf: 'RJ' },
                        { cidade: 'Belo Horizonte', uf: 'MG' },
                        { cidade: 'Porto Alegre', uf: 'RS' },
                        { cidade: 'Curitiba', uf: 'PR' },
                        { cidade: 'Salvador', uf: 'BA' }
                    ];
                    
                    const cidadeSelecionada = cidades[Math.floor(Math.random() * cidades.length)];
                    
                    endereco = {
                        logradouro: `Rua Exemplo ${Math.floor(Math.random() * 1000)}`,
                        bairro: 'Centro',
                        localidade: cidadeSelecionada.cidade,
                        uf: cidadeSelecionada.uf
                    };
                }
                
                // Preencher os campos
                ruaInput.value = endereco.logradouro;
                bairroInput.value = endereco.bairro;
                cidadeInput.value = endereco.localidade;
                estadoInput.value = endereco.uf;
                
                // Focar no campo de número
                numeroInput.focus();
                
            }, 800); // Simular delay de rede
        }
    </script>
</body>
</html>